<!DOCTYPE HTML>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
     <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
     <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
</head>

<body>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="world.js"></script>

    <div id="map" style="height:600px; width:750px"></div>

    <button id="button">click me</button>






    <div id="newsSpace"></div>
    <script type="text/template" id="newsTemplate">
      <%= stories %>
    </script>









  <script type="text/javascript">


// LOAD QUIZZES LIST AND RENDER ITS TEMPLATE


    var stories;

// QUIZ LIST TEMPLATE

var renderNewsTemplate = function () {
  var newsTemplate = _.template($("#newsTemplate").html());
  var resultingHtml = newsTemplate({stories: stories});
  $("#newsSpace").html(resultingHtml);
};


</script>


    <script type="text/javascript">

    // $('#button').on('click', function() {
    //     renderNewsTemplate();
    //     console.log('hi');
        
    // });


        var map = L.map('map', {
            center: [20, 10],
            zoom: 5,
            maxBounds: [[-100, 0], [90, 90]]
        });

        L.tileLayer('http://{s}.tiles.mapbox.com/v3/aschetter.j63jha01/{z}/{x}/{y}.png', {
            minZoom: 2,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>'
        }).addTo(map);

        var mouseOverStyle = {
            "fillOpacity": 0.7
        };

        var mouseOutStyle = {
            "fillOpacity": 0.3
        };

        var pickedStyle = {
            "color": "green"
        };

        var notPickedStyle = {
            "color": "blue"
        };

        var country = '';
        var nprUrl = '';

        var geojsonTileLayer = new L.GeoJSON(countriesData, {
            style: function(feature) {
                fillOpacity: 0.3;
                switch (feature.properties.picked) {
                    case true: return {color: 'green'};
                    case false: return {color: 'blue'};
                }
            },
            onEachFeature: function (feature, layer) {
                // layer.bindPopup(feature.properties.name);
                layer.on('mouseover', function () {
                    layer.setStyle(mouseOverStyle);
                    var name = layer.feature.properties.name;
                    var array = name.split(' ');
                    country = array.join('');
                    nprUrl = 'http://api.npr.org/query?searchTerm=' + country + '&numResults=5&output=JSON&apiKey=PASSWORD'
                    console.log('Name: ' + name);
                    console.log('array: ' + array);
                    console.log('country: ' + country);
                    console.log('nprUrl: ' + nprUrl);
                });
                layer.on('mouseout', function () {
                    layer.setStyle(mouseOutStyle);
                    country = '';
                    nprUrl = '';
                    console.log(country);
                });
                layer.on('click', function () {
                    if (feature.properties.picked == true) {
                        feature.properties.picked = false;
                        layer.setStyle(notPickedStyle);
                    } else {
                        feature.properties.picked = true;
                        layer.setStyle(pickedStyle);
                    }
                    console.log('Picked: ' + feature.properties.picked);
                    // $.getJSON('http://en.wikipedia.org/w/api.php?action=query&titles=Germany&format=json&callback=?')
                    //     .complete(function(data) {
                    //         console.log(data);
                    // }); 

                        // http://en.wikipedia.org/w/api.php?action=query&prop=extracts&exintro&titles=Turkey&format=json

                        // http://en.wikipedia.org/w/api.php?action=query&prop=pageimages|extracts&exintro&titles=Germany&format=jsonfm

                    // console.log(feature.properties);
                    $.getJSON(nprUrl).complete(function(data) {
                        stories = data.responseJSON.list.story;
                        console.log(stories);
                        renderNewsTemplate();
                    });       
                })
            }
        });

        map.addLayer(geojsonTileLayer);

        // [0].link[2].$text
        // [0].teaser.$text

        // var news = function (nprUrl) {
        // };

        // var nprUrl

        // L.geoJson(countriesData, {
        //     onEachFeature: function (data, layer) {
        //         layer.on('click', function () {
        //             var name = data.properties.name;
        //             var array = name.split(" ");
        //             var country = array.join("");
        //             var nprUrl = 'http://api.npr.org/query?searchTerm=' + country + '&numResults=5&apiKey=PASSWORD'
        //             // news(nprUrl);
        //             console.log(nprUrl);
        //             console.log(country);
        //         });
        //     }
        // }).addTo(map);

// function highlightFeature(e) {
//     var layer = e.target;

//     layer.setStyle({
//         weight: 5,
//         color: '#666',
//         dashArray: '',
//         fillOpacity: 0.7
//     });

// }

// L.geoJson(countriesData, {style: style}).addTo(map);


// geojson = L.geoJson(statesData, {
//     style: style,
//     onEachFeature: onEachFeature
// }).addTo(map);


        // $('#map').on('click', function () {
        //     $.ajax({
        //         type : 'get',
        //         url : 'http://api.npr.org/query?searchTerm=yemen&numResults=5&apiKey=PASSWORD',
        //         dataType : 'json',
        //     }).complete(function (data) {
        //         console.log(data)
        //     }); 
            
        // })

    </script>
</body>

</html>
